<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .tab {
            display: none;
        }

        .tab.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .nav-tabs {
            margin-bottom: 20px;
        }

        .nav-tabs button {
            padding: 10px 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Admin Dashboard</h1>

        <div class="nav-tabs">
            <button onclick="showTab('users')">Quản lý người dùng</button>
            <button onclick="showTab('menu')">Quản lý menu</button>
            <button onclick="showTab('tables')">Quản lý bàn</button>
            <button onclick="showTab('reservations')">Quản lý đặt bàn</button>
        </div>

        <!-- Tab Quản lý người dùng -->
        <div id="users" class="tab active">
            <h2>Danh sách người dùng</h2>
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Họ tên</th>
                        <th>Số điện thoại</th>
                        <th>Vai trò</th>
                        <th>Trạng thái</th>
                        <th>Lần đăng nhập cuối</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Modal Sửa thông tin người dùng -->
        <div id="editUserModal" class="modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
            <div class="modal-content" style="background: white; margin: 10% auto; padding: 20px; width: 50%;">
                <h3>Sửa thông tin người dùng</h3>
                <form id="editUserForm">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="editUsername" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Họ tên</label>
                        <input type="text" id="editFullName" required>
                    </div>
                    <div class="form-group">
                        <label>Số điện thoại</label>
                        <input type="tel" id="editPhone" required>
                    </div>
                    <div class="form-group">
                        <label>Vai trò</label>
                        <select id="editRole" required>
                            <option value="customer">Khách hàng</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Trạng thái</label>
                        <select id="editStatus" required>
                            <option value="active">Hoạt động</option>
                            <option value="inactive">Không hoạt động</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit">Lưu thay đổi</button>
                        <button type="button" onclick="closeEditModal()">Hủy</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tab Quản lý menu -->
        <div id="menu" class="tab">
            <h2>Quản lý menu</h2>
            <form id="menuForm">
                <div class="form-group">
                    <label>Tên món</label>
                    <input type="text" id="menuName" required>
                </div>
                <div class="form-group">
                    <label>Giá</label>
                    <input type="number" id="menuPrice" min="0" required>
                </div>
                <div class="form-group">
                    <label>Giá khuyến mãi</label>
                    <input type="number" id="menuSalePrice" min="0">
                </div>
                <div class="form-group">
                    <label>Danh mục</label>
                    <select id="menuCategory" required>
                        <option value="">Chọn danh mục</option>
                        <option value="appetizer">Món khai vị</option>
                        <option value="main_course">Món chính</option>
                        <option value="dessert">Tráng miệng</option>
                        <option value="drink">Đồ uống</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mô tả</label>
                    <textarea id="menuDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Hình ảnh</label>
                    <input type="text" id="menuImage" placeholder="URL hình ảnh">
                </div>
                <div class="form-group">
                    <label>Trạng thái</label>
                    <select id="menuStatus" required>
                        <option value="available">Có sẵn</option>
                        <option value="unavailable">Hết hàng</option>
                    </select>
                </div>
                <button type="submit">Thêm món</button>
            </form>
            <table id="menuTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tên món</th>
                        <th>Giá</th>
                        <th>Giá KM</th>
                        <th>Danh mục</th>
                        <th>Trạng thái</th>
                        <th>Hình ảnh</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Tab Quản lý bàn -->
        <div id="tables" class="tab">
            <h2>Quản lý bàn</h2>
            <div class="table-actions">
                <button onclick="showAddTableForm()" class="btn-primary">Thêm bàn mới</button>
            </div>
            <table id="tablesTable">
                <thead>
                    <tr>
                        <th>Số bàn</th>
                        <th>Sức chứa</th>
                        <th>Vị trí</th>
                        <th>Trạng thái</th>
                        <th>Ghi chú</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Form thêm/sửa bàn -->
        <div id="tableFormModal" class="modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
            <div class="modal-content" style="background: white; margin: 10% auto; padding: 20px; width: 50%;">
                <h3 id="tableFormTitle">Thêm bàn mới</h3>
                <form id="tableForm">
                    <div class="form-group">
                        <label>Số bàn</label>
                        <input type="text" id="tableNumber" required>
                    </div>
                    <div class="form-group">
                        <label>Sức chứa</label>
                        <input type="number" id="tableCapacity" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Vị trí</label>
                        <select id="tableLocation" required>
                            <option value="indoor">Trong nhà</option>
                            <option value="outdoor">Ngoài trời</option>
                            <option value="vip">Phòng VIP</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Trạng thái</label>
                        <select id="tableStatus" required>
                            <option value="available">Có sẵn</option>
                            <option value="reserved">Đã đặt</option>
                            <option value="occupied">Đang sử dụng</option>
                            <option value="maintenance">Bảo trì</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ghi chú</label>
                        <textarea id="tableNote" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit">Lưu</button>
                        <button type="button" onclick="closeTableForm()">Hủy</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tab Quản lý đặt bàn -->
        <div id="reservations" class="tab">
            <h2>Quản lý đặt bàn</h2>
            <div class="reservation-actions">
                <button onclick="checkLateReservations()" class="btn-warning">
                    <i class="fas fa-clock"></i>
                    Kiểm tra đặt bàn muộn
                </button>
                <div class="filters">
                    <select id="statusFilter" onchange="filterReservations()">
                        <option value="all">Tất cả trạng thái</option>
                        <option value="pending">Chờ xác nhận</option>
                        <option value="confirmed">Đã xác nhận</option>
                        <option value="deposit_paid">Đã đặt cọc</option>
                        <option value="completed">Hoàn thành</option>
                        <option value="cancelled">Đã hủy</option>
                        <option value="no_show">Không đến</option>
                    </select>
                    <input type="date" id="dateFilter" onchange="filterReservations()">
                </div>
            </div>
            <table id="reservationsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Bàn số</th>
                        <th>Thời gian</th>
                        <th>Số khách</th>
                        <th>Đặt cọc</th>
                        <th>Yêu cầu đặc biệt</th>
                        <th>Trạng thái</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // Kiểm tra quyền admin
        const token = localStorage.getItem('token');
        const role = localStorage.getItem('role');
        if (!token || role !== 'admin') {
            window.location.href = 'auth.html';
        }

        // Hàm hiển thị tab
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        }

        // Hàm gọi API với token
        async function fetchWithAuth(url, options = {}) {
            const defaultOptions = {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            };
            return fetch(url, { ...defaultOptions, ...options });
        }

        // Quản lý người dùng
        let editingUserId = null;

        async function loadUsers() {
            try {
                const response = await fetchWithAuth('http://localhost:3000/api/users');
                const users = await response.json();
                const tbody = document.querySelector('#usersTable tbody');
                tbody.innerHTML = users.map(user => `
                    <tr id="user-${user._id}">
                        <td>
                            <span class="view-mode">${user.username}</span>
                            <input type="text" class="edit-mode" value="${user.username}" style="display: none;">
                        </td>
                        <td>
                            <span class="view-mode">${user.email}</span>
                            <input type="email" class="edit-mode" value="${user.email}" style="display: none;">
                        </td>
                        <td>
                            <span class="view-mode">${user.full_name}</span>
                            <input type="text" class="edit-mode" value="${user.full_name}" style="display: none;">
                        </td>
                        <td>
                            <span class="view-mode">${user.phone}</span>
                            <input type="tel" class="edit-mode" value="${user.phone}" style="display: none;">
                        </td>
                        <td>
                            <span class="view-mode">${user.role === 'admin' ? 'Admin' : 'Khách hàng'}</span>
                            <select class="edit-mode" style="display: none;">
                                <option value="customer" ${user.role === 'customer' ? 'selected' : ''}>Khách hàng</option>
                                <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                            </select>
                        </td>
                        <td>
                            <span class="view-mode">${user.status === 'active' ? 'Hoạt động' : 'Không hoạt động'}</span>
                            <select class="edit-mode" style="display: none;">
                                <option value="active" ${user.status === 'active' ? 'selected' : ''}>Hoạt động</option>
                                <option value="inactive" ${user.status === 'inactive' ? 'selected' : ''}>Không hoạt động</option>
                            </select>
                        </td>
                        <td>${user.last_login ? new Date(user.last_login).toLocaleString('vi-VN') : 'Chưa đăng nhập'}</td>
                        <td>
                            <div class="view-mode">
                                <button onclick="startEdit('${user._id}')">Sửa</button>
                                <button onclick="deleteUser('${user._id}')">Xóa</button>
                            </div>
                            <div class="edit-mode" style="display: none;">
                                <button onclick="saveEdit('${user._id}')">Lưu</button>
                                <button onclick="cancelEdit('${user._id}')">Hủy</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
                alert('Có lỗi xảy ra khi tải danh sách người dùng!');
            }
        }

        function startEdit(userId) {
            const row = document.getElementById(`user-${userId}`);
            row.querySelectorAll('.view-mode').forEach(el => el.style.display = 'none');
            row.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'block');
            editingUserId = userId;
        }

        function cancelEdit(userId) {
            const row = document.getElementById(`user-${userId}`);
            row.querySelectorAll('.view-mode').forEach(el => el.style.display = 'block');
            row.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'none');
            editingUserId = null;
        }

        async function saveEdit(userId) {
            const row = document.getElementById(`user-${userId}`);
            const userData = {
                username: row.querySelector('input[type="text"]').value,
                email: row.querySelector('input[type="email"]').value,
                full_name: row.querySelectorAll('input[type="text"]')[1].value,
                phone: row.querySelector('input[type="tel"]').value,
                role: row.querySelectorAll('select')[0].value,
                status: row.querySelectorAll('select')[1].value
            };

            try {
                await fetchWithAuth(`http://localhost:3000/api/users/${userId}`, {
                    method: 'PUT',
                    body: JSON.stringify(userData)
                });
                loadUsers();
                alert('Cập nhật thông tin người dùng thành công!');
            } catch (error) {
                console.error('Error updating user:', error);
                alert('Có lỗi xảy ra khi cập nhật thông tin người dùng!');
            }
        }

        async function deleteUser(userId) {
            if (confirm('Bạn có chắc muốn xóa người dùng này?')) {
                try {
                    await fetchWithAuth(`http://localhost:3000/api/users/${userId}`, {
                        method: 'DELETE'
                    });
                    loadUsers();
                    alert('Xóa người dùng thành công!');
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Có lỗi xảy ra khi xóa người dùng!');
                }
            }
        }

        // Quản lý menu
        async function loadMenu() {
            try {
                const response = await fetchWithAuth('http://localhost:3000/api/menu');
                const menuItems = await response.json();
                const tbody = document.querySelector('#menuTable tbody');
                tbody.innerHTML = menuItems.map(item => `
                    <tr>
                        <td>${item._id}</td>
                        <td>${item.name}</td>
                        <td>${item.price.toLocaleString('vi-VN')}đ</td>
                        <td>${item.sale_price ? item.sale_price.toLocaleString('vi-VN') + 'đ' : '-'}</td>
                        <td>${getCategoryName(item.category)}</td>
                        <td>${item.status === 'available' ? 'Có sẵn' : 'Hết hàng'}</td>
                        <td>
                            ${item.image ? `<img src="${item.image}" alt="${item.name}" style="width: 50px; height: 50px; object-fit: cover;">` : 'Không có ảnh'}
                        </td>
                        <td>
                            <button onclick="editMenuItem('${item._id}')">Sửa</button>
                            <button onclick="deleteMenuItem('${item._id}')">Xóa</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading menu:', error);
            }
        }

        function getCategoryName(category) {
            const categories = {
                'appetizer': 'Món khai vị',
                'main_course': 'Món chính',
                'dessert': 'Tráng miệng',
                'drink': 'Đồ uống'
            };
            return categories[category] || category;
        }

        document.getElementById('menuForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const menuData = {
                name: document.getElementById('menuName').value,
                price: Number(document.getElementById('menuPrice').value),
                sale_price: document.getElementById('menuSalePrice').value ? Number(document.getElementById('menuSalePrice').value) : undefined,
                category: document.getElementById('menuCategory').value,
                description: document.getElementById('menuDescription').value,
                image: document.getElementById('menuImage').value,
                status: document.getElementById('menuStatus').value
            };

            try {
                await fetchWithAuth('http://localhost:3000/api/menu', {
                    method: 'POST',
                    body: JSON.stringify(menuData)
                });
                loadMenu();
                e.target.reset();
                alert('Thêm món thành công!');
            } catch (error) {
                console.error('Error adding menu item:', error);
                alert('Có lỗi xảy ra khi thêm món!');
            }
        });

        async function editMenuItem(menuId) {
            try {
                const response = await fetchWithAuth(`http://localhost:3000/api/menu/${menuId}`);
                const item = await response.json();

                document.getElementById('menuName').value = item.name;
                document.getElementById('menuPrice').value = item.price;
                document.getElementById('menuSalePrice').value = item.sale_price || '';
                document.getElementById('menuCategory').value = item.category;
                document.getElementById('menuDescription').value = item.description || '';
                document.getElementById('menuImage').value = item.image || '';
                document.getElementById('menuStatus').value = item.status;

                // Thay đổi form để cập nhật thay vì thêm mới
                const form = document.getElementById('menuForm');
                form.onsubmit = async (e) => {
                    e.preventDefault();
                    const menuData = {
                        name: document.getElementById('menuName').value,
                        price: Number(document.getElementById('menuPrice').value),
                        sale_price: document.getElementById('menuSalePrice').value ? Number(document.getElementById('menuSalePrice').value) : undefined,
                        category: document.getElementById('menuCategory').value,
                        description: document.getElementById('menuDescription').value,
                        image: document.getElementById('menuImage').value,
                        status: document.getElementById('menuStatus').value
                    };

                    try {
                        await fetchWithAuth(`http://localhost:3000/api/menu/${menuId}`, {
                            method: 'PUT',
                            body: JSON.stringify(menuData)
                        });
                        loadMenu();
                        form.reset();
                        form.onsubmit = null; // Reset lại form submit handler
                        alert('Cập nhật món thành công!');
                    } catch (error) {
                        console.error('Error updating menu item:', error);
                        alert('Có lỗi xảy ra khi cập nhật món!');
                    }
                };
            } catch (error) {
                console.error('Error loading menu item:', error);
                alert('Có lỗi xảy ra khi tải thông tin món!');
            }
        }

        async function deleteMenuItem(menuId) {
            if (confirm('Bạn có chắc muốn xóa món này?')) {
                try {
                    await fetchWithAuth(`http://localhost:3000/api/menu/${menuId}`, {
                        method: 'DELETE'
                    });
                    loadMenu();
                    alert('Xóa món thành công!');
                } catch (error) {
                    console.error('Error deleting menu item:', error);
                    alert('Có lỗi xảy ra khi xóa món!');
                }
            }
        }

        // Quản lý bàn
        let editingTableId = null;

        async function loadTables() {
            try {
                const response = await fetchWithAuth('http://localhost:3000/api/tables');
                const tables = await response.json();
                const tbody = document.querySelector('#tablesTable tbody');
                tbody.innerHTML = tables.map(table => `
                    <tr>
                        <td>${table.table_number}</td>
                        <td>${table.capacity} người</td>
                        <td>${getLocationName(table.location)}</td>
                        <td>${getStatusName(table.status)}</td>
                        <td>${table.note || 'Không có'}</td>
                        <td>
                            <button onclick="editTable('${table._id}')">Sửa</button>
                            <button onclick="deleteTable('${table._id}')">Xóa</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading tables:', error);
                alert('Có lỗi xảy ra khi tải danh sách bàn!');
            }
        }

        function getLocationName(location) {
            const locations = {
                'indoor': 'Trong nhà',
                'outdoor': 'Ngoài trời',
                'vip': 'Phòng VIP'
            };
            return locations[location] || location;
        }

        function getStatusName(status) {
            const statuses = {
                'available': 'Có sẵn',
                'reserved': 'Đã đặt',
                'occupied': 'Đang sử dụng',
                'maintenance': 'Bảo trì'
            };
            return statuses[status] || status;
        }

        function showAddTableForm() {
            document.getElementById('tableFormTitle').textContent = 'Thêm bàn mới';
            document.getElementById('tableForm').reset();
            editingTableId = null;
            document.getElementById('tableFormModal').style.display = 'block';
        }

        function closeTableForm() {
            document.getElementById('tableFormModal').style.display = 'none';
            editingTableId = null;
        }

        async function editTable(tableId) {
            try {
                const response = await fetchWithAuth(`http://localhost:3000/api/tables/${tableId}`);
                const table = await response.json();

                document.getElementById('tableFormTitle').textContent = 'Sửa thông tin bàn';
                document.getElementById('tableNumber').value = table.table_number;
                document.getElementById('tableCapacity').value = table.capacity;
                document.getElementById('tableLocation').value = table.location;
                document.getElementById('tableStatus').value = table.status;
                document.getElementById('tableNote').value = table.note || '';

                editingTableId = tableId;
                document.getElementById('tableFormModal').style.display = 'block';
            } catch (error) {
                console.error('Error loading table details:', error);
                alert('Có lỗi xảy ra khi tải thông tin bàn!');
            }
        }

        document.getElementById('tableForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const tableData = {
                table_number: document.getElementById('tableNumber').value,
                capacity: Number(document.getElementById('tableCapacity').value),
                location: document.getElementById('tableLocation').value,
                status: document.getElementById('tableStatus').value,
                note: document.getElementById('tableNote').value
            };

            try {
                const url = editingTableId
                    ? `http://localhost:3000/api/tables/${editingTableId}`
                    : 'http://localhost:3000/api/tables';
                const method = editingTableId ? 'PUT' : 'POST';

                await fetchWithAuth(url, {
                    method: method,
                    body: JSON.stringify(tableData)
                });

                loadTables();
                closeTableForm();
                alert(editingTableId ? 'Cập nhật bàn thành công!' : 'Thêm bàn mới thành công!');
            } catch (error) {
                console.error('Error saving table:', error);
                alert('Có lỗi xảy ra khi lưu thông tin bàn!');
            }
        });

        async function deleteTable(tableId) {
            if (confirm('Bạn có chắc muốn xóa bàn này?')) {
                try {
                    await fetchWithAuth(`http://localhost:3000/api/tables/${tableId}`, {
                        method: 'DELETE'
                    });
                    loadTables();
                    alert('Xóa bàn thành công!');
                } catch (error) {
                    console.error('Error deleting table:', error);
                    alert('Có lỗi xảy ra khi xóa bàn!');
                }
            }
        }

        // Quản lý đặt bàn
        let allReservations = [];

        async function loadReservations() {
            try {
                const response = await fetchWithAuth('http://localhost:3000/api/reservations');
                allReservations = await response.json();
                filterReservations();
            } catch (error) {
                console.error('Error loading reservations:', error);
                alert('Có lỗi xảy ra khi tải danh sách đặt bàn!');
            }
        }

        function filterReservations() {
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;

            let filteredReservations = [...allReservations];

            if (statusFilter !== 'all') {
                filteredReservations = filteredReservations.filter(res => res.status === statusFilter);
            }

            if (dateFilter) {
                const filterDate = new Date(dateFilter).toDateString();
                filteredReservations = filteredReservations.filter(res =>
                    new Date(res.reservation_time).toDateString() === filterDate
                );
            }

            const tbody = document.querySelector('#reservationsTable tbody');
            tbody.innerHTML = filteredReservations.map(res => `
                <tr>
                    <td>${res._id}</td>
                    <td>${res.table_id}</td>
                    <td>${new Date(res.reservation_time).toLocaleString('vi-VN')}</td>
                    <td>${res.number_of_guests}</td>
                    <td>${res.deposit_required ? 'Có' : 'Không'}</td>
                    <td>${res.special_requests || 'Không có'}</td>
                    <td>
                        <select onchange="updateReservationStatus('${res._id}', this.value)">
                            <option value="pending" ${res.status === 'pending' ? 'selected' : ''}>Chờ xác nhận</option>
                            <option value="confirmed" ${res.status === 'confirmed' ? 'selected' : ''}>Đã xác nhận</option>
                            <option value="deposit_paid" ${res.status === 'deposit_paid' ? 'selected' : ''}>Đã đặt cọc</option>
                            <option value="completed" ${res.status === 'completed' ? 'selected' : ''}>Hoàn thành</option>
                            <option value="cancelled" ${res.status === 'cancelled' ? 'selected' : ''}>Đã hủy</option>
                            <option value="no_show" ${res.status === 'no_show' ? 'selected' : ''}>Không đến</option>
                        </select>
                    </td>
                    <td>
                        <button onclick="markNoShow('${res._id}')" ${res.status === 'no_show' ? 'disabled' : ''}>
                            Đánh dấu không đến
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        async function updateReservationStatus(reservationId, status) {
            try {
                await fetchWithAuth(`http://localhost:3000/api/reservations/status/${reservationId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status })
                });
                loadReservations();
                alert('Cập nhật trạng thái đặt bàn thành công!');
            } catch (error) {
                console.error('Error updating reservation status:', error);
                alert('Có lỗi xảy ra khi cập nhật trạng thái đặt bàn!');
            }
        }

        async function markNoShow(reservationId) {
            if (confirm('Bạn có chắc muốn đánh dấu đặt bàn này là không đến?')) {
                try {
                    await fetchWithAuth(`http://localhost:3000/api/reservations/no-show/${reservationId}`, {
                        method: 'POST'
                    });
                    loadReservations();
                    alert('Đã đánh dấu đặt bàn là không đến!');
                } catch (error) {
                    console.error('Error marking no-show:', error);
                    alert('Có lỗi xảy ra khi đánh dấu không đến!');
                }
            }
        }

        async function checkLateReservations() {
            try {
                const response = await fetchWithAuth('http://localhost:3000/api/reservations/check-late');
                const result = await response.json();
                loadReservations();
                alert(result.message || 'Đã kiểm tra các đặt bàn đến muộn!');
            } catch (error) {
                console.error('Error checking late reservations:', error);
                alert('Có lỗi xảy ra khi kiểm tra đặt bàn đến muộn!');
            }
        }

        // Load dữ liệu ban đầu
        loadUsers();
        loadMenu();
        loadTables();
        loadReservations();
    </script>
</body>

</html>